name: Frontend CI

on:
  push:
    branches: [main, dev]
    paths:
      - "frontEnd/**"
      - "infra/**"
      - "docker-compose.yml"
      - ".env"
      - ".github/workflows/frontend.yml"

  pull_request:
    branches: [main, dev]
    paths:
      - "frontEnd/**"
      - "infra/**"
      - "docker-compose.yml"
      - ".env"
      - ".github/workflows/frontend.yml"

jobs:
  build-test-dockerize:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: frontEnd/kolyya-frontend

    env:
      IMAGE_NAME: kolyya-frontend
      IMAGE_TAG: ${{ github.sha }} # Tag unique basé sur le commit

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Use Node.js 20
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      - name: Run lint check
        run: npm run lint

      - name: Run unit tests with Vitest
        run: npx vitest run

      - name: Build Angular app
        run: npm run build

      - name: Build Docker image
        run: docker build -t $IMAGE_NAME:$IMAGE_TAG .

      # - name: Log in to Docker Hub (décommenter pour déploiement)
      #   uses: docker/login-action@v2
      #   with:
      #     username: ${{ secrets.DOCKER_USERNAME }}
      #     password: ${{ secrets.DOCKER_PASSWORD }}

      # - name: Push Docker image to Docker Hub
      #   run: docker push ${{ secrets.DOCKER_USERNAME }}/$IMAGE_NAME:$IMAGE_TAG
